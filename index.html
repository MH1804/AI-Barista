<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Barista Companion</title>

<style>
:root {
  --bg: #f6f3ef;
  --card: #ffffff;
  --accent: #8b4513;
  --text: #3b2f2f;
  --muted: #9b8f8f;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg);
  color: var(--text);
}

.app {
  max-width: 520px;
  margin: auto;
  padding: 24px;
}

h1 {
  text-align: center;
  margin-bottom: 16px;
}

.progress {
  height: 6px;
  background: #e5e0db;
  border-radius: 4px;
  margin-bottom: 24px;
}

.progress-bar {
  height: 100%;
  background: var(--accent);
  width: 0%;
  border-radius: 4px;
  transition: width 0.3s ease;
}

.card {
  background: var(--card);
  border-radius: 14px;
  padding: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.05);
}

.card h2 {
  margin-top: 0;
}

input, button {
  width: 100%;
  padding: 12px 14px;
  margin-top: 12px;
  border-radius: 8px;
  font-size: 16px;
}

input {
  border: 1px solid #ddd;
}

button {
  background: var(--accent);
  color: white;
  border: none;
  cursor: pointer;
}

button.secondary {
  background: #ddd;
  color: #333;
}

.result {
  line-height: 1.6;
}

small {
  color: var(--muted);
}
</style>
</head>

<body>
<div class="app">
  <h1>☕ Barista Companion</h1>

  <div class="progress">
    <div class="progress-bar" id="progress"></div>
  </div>

  <div id="card" class="card"></div>
</div>

<datalist id="roasteries"></datalist>
<datalist id="origins"></datalist>
<datalist id="processes"></datalist>
<datalist id="roastlevels"></datalist>

<script>
/* ---------- DATA ---------- */

const defaults = {
  roasteries: ['Bonanza', 'Kaffeemacher'],
  origins: ['Äthiopien', 'Kolumbien', 'Kenia', 'Brasilien', 'Guatemala'],
  processes: ['Washed', 'Natural', 'Honey', 'Anaerobic'],
  roastlevels: ['Light', 'Medium', 'Dark']
};

for (const key in defaults) {
  if (!localStorage.getItem(key)) {
    localStorage.setItem(key, JSON.stringify(defaults[key]));
  }
}

const lists = {};
for (const key in defaults) {
  lists[key] = JSON.parse(localStorage.getItem(key));
  const dl = document.getElementById(key);
  dl.innerHTML = lists[key].map(v => `<option value="${v}">`).join('');
}

/* ---------- STATE ---------- */

const steps = [
  'roastery',
  'origin',
  'process',
  'roastlevel',
  'roastdate',
  'analyze',
  'feedback'
];

let state = {
  step: 0,
  data: {}
};

/* ---------- RENDER ---------- */

function render() {
  const card = document.getElementById('card');
  const progress = document.getElementById('progress');
  progress.style.width = ((state.step) / steps.length) * 100 + '%';

  const step = steps[state.step];

  if (step === 'roastery') {
    card.innerHTML = `
      <h2>Rösterei</h2>
      <input list="roasteries" id="input" placeholder="z.B. Bonanza">
      <button onclick="next('roastery')">Weiter</button>
    `;
  }

  if (step === 'origin') {
    card.innerHTML = `
      <h2>Herkunft</h2>
      <input list="origins" id="input" placeholder="z.B. Äthiopien">
      <button onclick="next('origin')">Weiter</button>
    `;
  }

  if (step === 'process') {
    card.innerHTML = `
      <h2>Aufbereitung</h2>
      <input list="processes" id="input" placeholder="z.B. Washed">
      <button onclick="next('process')">Weiter</button>
    `;
  }

  if (step === 'roastlevel') {
    card.innerHTML = `
      <h2>Röstgrad</h2>
      <input list="roastlevels" id="input" placeholder="z.B. Light">
      <button onclick="next('roastlevel')">Weiter</button>
    `;
  }

  if (step === 'roastdate') {
    card.innerHTML = `
      <h2>Röstdatum</h2>
      <input type="date" id="input">
      <button onclick="next('roastdate')">Analysieren</button>
    `;
  }

  if (step === 'analyze') {
    const age = Math.floor((Date.now() - new Date(state.data.roastdate)) / 86400000);
    const grind = age < 7 ? 6.2 : age > 30 ? 5.8 : 6.0;

    state.data.recommendation = { dose: 15, yield: 30, ratio: '1:2', grind };

    card.innerHTML = `
      <h2>Empfehlung</h2>
      <div class="result">
        <strong>Dosis:</strong> 15 g<br>
        <strong>Getränk:</strong> 30 g<br>
        <strong>Ratio:</strong> 1:2<br>
        <strong>Mahlgrad:</strong> ${grind}<br><br>
        <small>Bohnenalter: ${age} Tage</small>
      </div>
      <button onclick="next()">Feedback</button>
    `;
  }

  if (step === 'feedback') {
    card.innerHTML = `
      <h2>Feedback</h2>
      <input id="taste" placeholder="Geschmack (sauer/ausgewogen/bitter)">
      <button onclick="save()">Speichern</button>
    `;
  }
}

/* ---------- LOGIC ---------- */

function next(key) {
  const input = document.getElementById('input');
  if (key && (!input || !input.value)) return;

  if (key) {
    state.data[key] = input.value;
    const arr = lists[key + 's'];
    if (arr && !arr.includes(input.value)) {
      arr.push(input.value);
      localStorage.setItem(key + 's', JSON.stringify(arr));
    }
  }

  state.step++;
  render();
}

function save() {
  state.data.feedback = document.getElementById('taste').value;
  const shots = JSON.parse(localStorage.getItem('shots') || '[]');
  shots.push(state.data);
  localStorage.setItem('shots', JSON.stringify(shots));
  alert('Shot gespeichert ☕');
  state = { step: 0, data: {} };
  render();
}

/* ---------- START ---------- */
render();
</script>
</body>
</html>
